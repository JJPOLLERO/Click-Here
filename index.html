<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Click Here</title>
<style>
  html, body {
    margin:0; padding:0; width:100%; height:100%; overflow:hidden;
    font-family: Arial, sans-serif;
    background: #000814;
  }
  .screen {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content:center;
    align-items: center;
    background: #f8bbd0;
    transition: opacity 0.8s ease;
  }
  #numberScreen input {
    padding: 12px; font-size: 1.2rem; border-radius: 8px; border: 1px solid #b71c1c; margin-bottom: 15px; width: 200px;
  }
  #numberScreen button {
    padding: 12px 30px; font-size: 1.1rem; border-radius: 30px; border:none;
    background: #e91e63; color: white; cursor: pointer;
  }
  #envelopeScreen {
    background: #fce4ec;
    opacity: 0; pointer-events: none;
  }
  .envelope {
    width: 220px; height: 140px;
    background: #e57373;
    border-radius: 4px;
    position: relative;
    cursor: pointer;
  }
  .envelope::before {
    content: "";
    position: absolute;
    top: 0; left: 0;
    border-left: 110px solid transparent;
    border-right: 110px solid transparent;
    border-top: 70px solid #ef9a9a;
  }
  .click-text {
    margin-top: 20px;
    color: #b71c1c;
    font-size: 1.2rem;
  }
  #question {
    display: none;
    text-align: center;
  }
  #question h1 {
    color: #b71c1c;
    margin-bottom: 20px;
  }
  #question button {
    padding: 12px 30px;
    font-size: 1.1rem;
    border-radius: 30px;
    border: none;
    background: #e91e63;
    color: white;
    cursor: pointer;
  }
  #skyScreen {
    background: #000814;
    opacity: 0; pointer-events: none;
    position: relative;
  }
  canvas {
    width: 100vw;
    height: 100vh;
    display: block;
  }
  #message {
    position: absolute;
    bottom: 15%;
    width: 90%;
    text-align: center;
    color: white;
    font-size: clamp(1.2rem, 4vw, 2rem);
    line-height: 1.5;
    text-shadow: 0 0 15px rgba(255,255,255,0.6);
  }
</style>
</head>
<body>

<!-- Secret Number Screen -->
<div id="numberScreen" class="screen">
  <h2>Enter your secret number ðŸ’Œ</h2>
  <input type="number" id="userNumber" placeholder="Enter number" autocomplete="off" />
  <button id="checkNumberBtn">Proceed</button>
</div>

<!-- Envelope Screen -->
<div id="envelopeScreen" class="screen">
  <div class="envelope" id="envelope"></div>
  <div class="click-text">Click the envelope ðŸ’Œ</div>

  <div id="question">
    <h1>Will you be my Valentine?</h1>
    <button id="yesBtn">Yes of course ðŸ’–</button>
  </div>
</div>

<!-- Night Sky Screen -->
<div id="skyScreen" class="screen">
  <canvas id="sky"></canvas>
  <div id="message"></div>
</div>

<!-- Audio -->
<audio id="music" src="araw-araw.mp3" preload="auto"></audio>

<script>
  // Elements
  const numberScreen = document.getElementById("numberScreen");
  const userNumber = document.getElementById("userNumber");
  const checkNumberBtn = document.getElementById("checkNumberBtn");
  const envelopeScreen = document.getElementById("envelopeScreen");
  const envelope = document.getElementById("envelope");
  const question = document.getElementById("question");
  const yesBtn = document.getElementById("yesBtn");
  const skyScreen = document.getElementById("skyScreen");
  const music = document.getElementById("music");
  const messageEl = document.getElementById("message");

  const correctNumber = "09776777105";

  // Secret number check
  checkNumberBtn.onclick = () => {
    if (userNumber.value === correctNumber) {
      numberScreen.style.opacity = 0;
      setTimeout(() => {
        numberScreen.style.display = "none";
        envelopeScreen.style.opacity = 1;
        envelopeScreen.style.pointerEvents = "auto";
      }, 500);
    } else {
      alert("Wrong secret number âŒ");
    }
  };

  // Envelope click
  envelope.onclick = () => {
    envelope.style.display = "none";
    document.querySelector(".click-text").style.display = "none";
    question.style.display = "block";
  };

  // Yes button click
  yesBtn.onclick = () => {
    envelopeScreen.style.opacity = 0;
    setTimeout(() => {
      envelopeScreen.style.display = "none";
      skyScreen.style.opacity = 1;
      skyScreen.style.pointerEvents = "auto";
      startNightSky();

      music.muted = false;
      music.currentTime = 0;
      music.play().catch(() => {
        console.log("User interaction required to play music");
      });

      revealMessage();
    }, 1000);
  };

  // Valentine message reveal word-by-word
  const valentineMessage = "Hi love, thank you for always being with me through ups and downs. I hope our relationship becomes stronger, and I hope that when we are both successful, we look back at these days with smiles, knowing we grew together, supported each other, and never gave up. You are my favorite part of every araw-araw.";
  function revealMessage() {
    const words = valentineMessage.split(" ");
    let i = 0;
    messageEl.textContent = "";
    const interval = setInterval(() => {
      messageEl.textContent += (i === 0 ? "" : " ") + words[i];
      i++;
      if (i === words.length) clearInterval(interval);
    }, 300);
  }

  // Canvas & Night sky code
  const canvas = document.getElementById("sky");
  const ctx = canvas.getContext("2d");
  let stars = [];
  let moons = [];

  const moonData = [
    {x: 0.2, y: 0.3, r: 30, img: 'moon1.jpg', popped: false},
    {x: 0.7, y: 0.25, r: 30, img: 'moon2.jpg', popped: false},
    {x: 0.35, y: 0.6, r: 30, img: 'moon3.jpg', popped: false},
    {x: 0.8, y: 0.65, r: 30, img: 'moon4.jpg', popped: false}
  ];

  const moonImages = [];
  let imagesLoaded = 0;

  // Load moon images
  moonData.forEach((m, i) => {
    const img = new Image();
    img.src = m.img;
    img.onload = () => {
      imagesLoaded++;
      if (imagesLoaded === moonData.length) {
        // Start drawing only after all images loaded
        setup();
        animateStars();
      }
    };
    moonImages[i] = img;
  });

  function setup() {
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);
    // Map moons with real pixel positions
    moons = moonData.map(m => ({
      ...m,
      x: m.x * window.innerWidth,
      y: m.y * window.innerHeight,
      popped: false,
      r: m.r
    }));
    initStars();
  }

  function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  function initStars() {
    stars = [];
    const totalStars = Math.floor((window.innerWidth * window.innerHeight) / 1500);
    for (let i = 0; i < totalStars; i++) {
      stars.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: Math.random() * 1.5,
        alpha: Math.random()
      });
    }
  }

  function drawSky() {
    ctx.fillStyle = '#000814';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw stars
    stars.forEach(s => {
      ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fill();
    });

    // Draw moons
    moons.forEach((m, i) => {
      ctx.save();
      ctx.beginPath();
      ctx.arc(m.x, m.y, m.r, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      if (m.popped) {
        ctx.drawImage(moonImages[i], m.x - m.r, m.y - m.r, m.r * 2, m.r * 2);
      } else {
        ctx.fillStyle = 'rgba(255,230,180,0.9)';
        ctx.fill();
      }
      ctx.restore();
    });
  }

  function animateStars() {
    stars.forEach(s => {
      s.alpha += (Math.random() - 0.5) * 0.05;
      if (s.alpha > 1) s.alpha = 1;
      if (s.alpha < 0) s.alpha = 0;
    });
    drawSky();
    requestAnimationFrame(animateStars);
  }

  // Click on moons to reveal images
  canvas.addEventListener("click", e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    moons.forEach(m => {
      const dx = mx - m.x;
      const dy = my - m.y;
      if (Math.sqrt(dx * dx + dy * dy) <= m.r && !m.popped) {
        m.popped = true;
        drawSky(); // immediate redraw
      }
    });
  });

  function startNightSky() {
    // Just call setup if images already loaded, else will be called on image load
    if (imagesLoaded === moonData.length) {
      setup();
      animateStars();
    }
  }
</script>

</body>
</html>
